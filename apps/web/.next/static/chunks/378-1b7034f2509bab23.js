"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{9378:function(r,e,t){t.d(e,{MI:function(){return R},Cq:function(){return m},CC:function(){return p},sT:function(){return _},xG:function(){return l},yS:function(){return f},NO:function(){return g},nS:function(){return s},Zn:function(){return A},Ly:function(){return E},vV:function(){return i},eW:function(){return c},ck:function(){return b},ZH:function(){return T}});var n=t(7247);let o=n.Km(["Brickwork","Blockwork","Repointing","Demo+Rebuild"]),a=n.Km(["Easy","Standard","Tricky"]),u=n.Km(["length","height"]);function i(r){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)}function c(r){return r.length<8?{valid:!1,message:"Password must be at least 8 characters"}:{valid:!0}}async function _(r){return new Promise((e,t)=>{let n=new FileReader;n.readAsDataURL(r),n.onload=()=>{e(n.result.split(",")[1])},n.onerror=r=>t(r)})}function l(r){return"\xa3".concat(r.toLocaleString("en-GB",{minimumFractionDigits:0,maximumFractionDigits:0}))}function s(r,e){let t=e||(r=>r.toLocaleString("en-GB"));return"".concat(t(r[0])," – ").concat(t(r[1]))}function g(r){return s(r,l)}function d(r){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return Math.ceil(r/e*10)/10}function f(r){let e=d(r[0]),t=d(r[1]),n=r[0],o=r[1];return"".concat(n,"–").concat(o," hours (").concat(e,"–").concat(t," days)")}n.Ry({jobType:o,anchorType:u,anchorValue:n.Rx().positive().max(100),difficulty:a,hasOpenings:n.O7(),photoUri:n.Z_().optional(),photoUrl:n.Z_().url().optional()}),n.Ry({area_m2:n.Rx().nonnegative(),brick_count_range:n.bc([n.Rx(),n.Rx()]),materials:n.Ry({sand_kg_range:n.bc([n.Rx(),n.Rx()]),cement_bags_range:n.bc([n.Rx(),n.Rx()]),other:n.IX(n.Z_())}),labour_hours_range:n.bc([n.Rx(),n.Rx()]),recommended_price_gbp_range:n.bc([n.Rx(),n.Rx()]),assumptions:n.IX(n.Z_()),exclusions:n.IX(n.Z_()),notes:n.IX(n.Z_())});let h={BRICK_COST_EACH:.55,BLOCK_COST_EACH:1.8,SAND_COST_PER_KG:.04,CEMENT_BAG_COST:7.5,DEFAULT_DAY_RATE:220,DEFAULT_RATE_PER_1000:500,DEFAULT_RATE_PER_M2:65,HOURS_PER_DAY:8};function R(r,e){let t,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Brickwork",a=(r.brick_count_range[0]+r.brick_count_range[1])/2;r.labour_hours_range[0],r.labour_hours_range[1];let u=(r.materials.sand_kg_range[0]+r.materials.sand_kg_range[1])/2,i=(r.materials.cement_bags_range[0]+r.materials.cement_bags_range[1])/2;switch(e.method){case"day_rate":{let o=e.dayRate||h.DEFAULT_DAY_RATE,a=r.labour_hours_range[0]/h.HOURS_PER_DAY,u=r.labour_hours_range[1]/h.HOURS_PER_DAY;t=a*o,n=u*o;break}case"per_1000_bricks":{let o=e.ratePer1000||h.DEFAULT_RATE_PER_1000;t=r.brick_count_range[0]/1e3*o,n=r.brick_count_range[1]/1e3*o;break}case"per_m2":{let o=e.ratePerM2||h.DEFAULT_RATE_PER_M2;t=.95*r.area_m2*o,n=1.05*r.area_m2*o;break}default:{let o=e.dayRate||h.DEFAULT_DAY_RATE,a=r.labour_hours_range[0]/h.HOURS_PER_DAY,u=r.labour_hours_range[1]/h.HOURS_PER_DAY;t=a*o,n=u*o}}let c=(a*("Blockwork"===o?h.BLOCK_COST_EACH:h.BRICK_COST_EACH)+u*h.SAND_COST_PER_KG+i*h.CEMENT_BAG_COST)*(1+e.materialMarkup/100),_=.9*c,l=1.1*c,s=t+_,g=n+l,d=0,f=0;e.includeVAT&&(d=e.vatRate/100*s,f=e.vatRate/100*g);let R=s+d,b=g+f;return{labourLow:Math.round(t),labourHigh:Math.round(n),materialsLow:Math.round(_),materialsHigh:Math.round(l),subtotalLow:Math.round(s),subtotalHigh:Math.round(g),vatLow:Math.round(d),vatHigh:Math.round(f),totalLow:Math.round(R),totalHigh:Math.round(b)}}async function b(r,e,t){let{data:n,error:o}=await r.from("profiles").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw console.error("Error updating profile:",o),o;return n}async function m(r,e,t,n,o){let{data:a,error:u}=await r.from("jobs").insert({user_id:e,photo_url:o,inputs:t,outputs:n}).select().single();if(u)throw console.error("Error creating job:",u),u;return a}async function E(r,e){let{data:t,error:n}=await r.from("jobs").select("*").eq("user_id",e).order("created_at",{ascending:!1});return n?(console.error("Error fetching jobs:",n),[]):t||[]}async function A(r,e,t){let{data:n,error:o}=await r.from("jobs").select("*").eq("id",e).eq("user_id",t).single();return o?(console.error("Error fetching job:",o),null):n}async function p(r,e,t){let{error:n}=await r.from("jobs").delete().eq("id",e).eq("user_id",t);return!n||(console.error("Error deleting job:",n),!1)}async function T(r,e,t,n){let o="".concat(e,"/").concat(Date.now(),"-").concat(n),{error:a}=await r.storage.from("job-images").upload(o,t,{cacheControl:"3600",upsert:!1});if(a)return console.error("Error uploading image:",a),null;let{data:u}=r.storage.from("job-images").getPublicUrl(o);return u.publicUrl}}}]);