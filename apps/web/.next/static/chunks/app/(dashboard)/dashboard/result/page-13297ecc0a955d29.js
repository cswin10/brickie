(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{6125:function(e,t,a){Promise.resolve().then(a.bind(a,5051))},5051:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(6517),r=a(6557),i=a(6815),n=a(104),l=a(1052),c=a(9843),o=a(2338),d=a(1117);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,a(5802).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var u=a(9115),x=a(1184),p=a(9250),h=a(9378),b=a(4988);function f(){var e,t,a;let f=(0,i.useRouter)(),[j,w]=(0,r.useState)(!1),[y,g]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),{currentResult:T,photoFile:_,photoPreview:k,user:S,profile:P,addJob:M,resetEstimate:R,getInputs:A,getPricingInputs:E}=(0,x.o)(),z=A(),L=E(),F=(0,r.useMemo)(()=>T&&z?(0,h.MI)(T,L,z.jobType):null,[T,L,z]);if(!T||!z||!F)return(0,s.jsxs)("div",{className:"max-w-2xl mx-auto text-center py-12",children:[(0,s.jsx)("p",{className:"text-warm-600 mb-4",children:"No estimate results available"}),(0,s.jsx)(u.zx,{onClick:()=>f.push("/dashboard"),children:"Start New Estimate"})]});let O=async()=>{if(S){w(!0);try{let e=(0,p.e)(),t=null;_&&(t=await (0,h.ZH)(e,S.id,_,_.name));let a=await (0,h.Cq)(e,S.id,z,T,t);M(a),N(!0)}catch(e){console.error("Failed to save job:",e)}finally{w(!1)}}},C=async()=>{if(P){g(!0);try{await (0,b.b)({id:"temp-".concat(Date.now()),timestamp:Date.now(),inputs:z,outputs:T,photoUri:k||""},{companyName:P.company_name||"",defaultDayRate:P.day_rate||220,defaultPricingMethod:"day_rate",defaultRatePer1000:500,defaultRatePerM2:65,materialMarkup:10,vatRegistered:!1,vatRate:20,currency:"GBP",disclaimerText:P.disclaimer_text||""})}catch(e){console.error("Failed to generate PDF:",e)}finally{g(!1)}}},I={day_rate:"\xa3".concat(L.dayRate,"/day"),per_1000_bricks:"\xa3".concat(L.ratePer1000,"/1000 bricks"),per_m2:"\xa3".concat(L.ratePerM2,"/m\xb2")}[L.method];return(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-warm-900 mb-6",children:"Estimate Results"}),(0,s.jsxs)("div",{className:"space-y-6",children:[k&&(0,s.jsx)("img",{src:k,alt:"Job photo",className:"w-full h-48 object-cover rounded-xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-warm-900",children:z.jobType}),(0,s.jsxs)("p",{className:"text-warm-600",children:[z.anchorType,": ",z.anchorValue,"m • ",z.difficulty,z.hasOpenings?" • Has openings":""]})]}),(0,s.jsxs)("div",{className:"bg-brick-500 rounded-2xl p-6 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,s.jsx)(n.Z,{className:"w-5 h-5 opacity-80"}),(0,s.jsx)("span",{className:"text-sm font-medium opacity-80",children:"YOUR QUOTE"})]}),(0,s.jsxs)("div",{className:"space-y-2 mb-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between opacity-90",children:[(0,s.jsxs)("span",{children:["Labour (",I,")"]}),(0,s.jsxs)("span",{children:[(0,h.xG)(F.labourLow)," – ",(0,h.xG)(F.labourHigh)]})]}),(0,s.jsxs)("div",{className:"flex justify-between opacity-90",children:[(0,s.jsxs)("span",{children:["Materials (",L.materialMarkup,"% markup)"]}),(0,s.jsxs)("span",{children:[(0,h.xG)(F.materialsLow)," – ",(0,h.xG)(F.materialsHigh)]})]}),L.includeVAT&&(0,s.jsxs)("div",{className:"flex justify-between opacity-90",children:[(0,s.jsx)("span",{children:"VAT (20%)"}),(0,s.jsxs)("span",{children:[(0,h.xG)(F.vatLow)," – ",(0,h.xG)(F.vatHigh)]})]}),(0,s.jsx)("div",{className:"border-t border-white/30 pt-2 mt-2"})]}),(0,s.jsxs)("p",{className:"text-3xl font-bold",children:[(0,h.xG)(F.totalLow)," – ",(0,h.xG)(F.totalHigh)]}),L.includeVAT&&(0,s.jsx)("p",{className:"text-sm opacity-80 mt-1",children:"inc. VAT"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)(u.Zb,{className:"bg-warm-100",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)(l.Z,{className:"w-4 h-4 text-warm-600"}),(0,s.jsx)("span",{className:"text-xs font-medium text-warm-600 uppercase",children:"Labour"})]}),(0,s.jsx)("p",{className:"text-lg font-semibold text-warm-900",children:(0,h.yS)(T.labour_hours_range)})]}),(0,s.jsxs)(u.Zb,{className:"bg-warm-100",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-warm-600 uppercase",children:"Area"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-warm-900",children:[T.area_m2.toFixed(1)," m\xb2"]})]})]}),(0,s.jsx)(u.Zb,{title:"Materials",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-warm-200",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Z,{className:"w-4 h-4 text-brick-500"}),(0,s.jsx)("span",{className:"text-warm-700",children:"Bricks"})]}),(0,s.jsx)("span",{className:"font-semibold text-warm-900",children:(0,h.nS)(T.brick_count_range)})]}),(0,s.jsxs)("div",{className:"flex justify-between py-2 border-b border-warm-200",children:[(0,s.jsx)("span",{className:"text-warm-700",children:"Sand"}),(0,s.jsxs)("span",{className:"font-semibold text-warm-900",children:[(0,h.nS)(T.materials.sand_kg_range)," kg"]})]}),(0,s.jsxs)("div",{className:"flex justify-between py-2",children:[(0,s.jsx)("span",{className:"text-warm-700",children:"Cement"}),(0,s.jsxs)("span",{className:"font-semibold text-warm-900",children:[(0,h.nS)(T.materials.cement_bags_range)," bags"]})]}),(null===(e=T.materials.other)||void 0===e?void 0:e.length)>0&&(0,s.jsxs)("div",{className:"pt-2 border-t border-warm-200",children:[(0,s.jsx)("p",{className:"text-sm text-warm-600 mb-1",children:"Other:"}),(0,s.jsx)("ul",{className:"list-disc list-inside text-sm text-warm-700",children:T.materials.other.map((e,t)=>(0,s.jsx)("li",{children:e},t))})]})]})}),(null===(t=T.assumptions)||void 0===t?void 0:t.length)>0&&(0,s.jsx)(u.Zb,{title:"Assumptions",children:(0,s.jsx)("ul",{className:"space-y-2",children:T.assumptions.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-brick-500 rounded-full mt-2"}),(0,s.jsx)("span",{className:"text-warm-700",children:e})]},t))})}),(null===(a=T.exclusions)||void 0===a?void 0:a.length)>0&&(0,s.jsx)(u.Zb,{title:"Exclusions",children:(0,s.jsx)("ul",{className:"space-y-2",children:T.exclusions.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full mt-2"}),(0,s.jsx)("span",{className:"text-warm-700",children:e})]},t))})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)(u.zx,{variant:"outline",fullWidth:!0,onClick:C,loading:y,children:[(0,s.jsx)(o.Z,{className:"w-5 h-5 mr-2"}),"Generate PDF"]}),(0,s.jsxs)(u.zx,{variant:"secondary",fullWidth:!0,onClick:O,loading:j,disabled:v,children:[(0,s.jsx)(d.Z,{className:"w-5 h-5 mr-2"}),v?"Saved":"Save Job"]}),(0,s.jsxs)(u.zx,{fullWidth:!0,onClick:()=>{R(),f.push("/dashboard")},children:[(0,s.jsx)(m,{className:"w-5 h-5 mr-2"}),"New Estimate"]})]}),(0,s.jsx)("p",{className:"text-xs text-warm-500 text-center",children:"This is an estimate only. Actual costs may vary based on site conditions, material prices, and scope changes."})]})]})}},4988:function(e,t,a){"use strict";a.d(t,{b:function(){return i}});var s=a(2693),r=a(9378);async function i(e,t){var a,i;let n=await s.PDFDocument.create(),l=n.addPage([595,842]),{height:c}=l.getSize(),o=await n.embedFont(s.StandardFonts.Helvetica),d=await n.embedFont(s.StandardFonts.HelveticaBold),m=c-50,u=(0,s.rgb)(.2,.2,.2),x=(0,s.rgb)(.4,.4,.4),p=(0,s.rgb)(.73,.27,.17);l.drawText("BRICKIE ESTIMATE",{x:50,y:m,size:24,font:d,color:p}),m-=30,t.companyName&&(l.drawText(t.companyName,{x:50,y:m,size:14,font:d,color:u}),m-=18);let h=new Date(e.timestamp).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});for(let t of(l.drawText("Date: ".concat(h),{x:50,y:m,size:10,font:o,color:x}),m-=25,l.drawText("JOB DETAILS",{x:50,y:m,size:12,font:d,color:u}),m-=18,["Job Type: ".concat(e.inputs.jobType),"Anchor Dimension: ".concat(e.inputs.anchorType," = ").concat(e.inputs.anchorValue,"m"),"Difficulty: ".concat(e.inputs.difficulty),"Has Openings: ".concat(e.inputs.hasOpenings?"Yes":"No"),"Estimated Area: ".concat(e.outputs.area_m2.toFixed(1)," m\xb2")]))l.drawText(t,{x:50,y:m,size:10,font:o,color:u}),m-=18;for(let t of(m-=7,l.drawText("ESTIMATED PRICE",{x:50,y:m,size:12,font:d,color:u}),m-=23,l.drawText((0,r.NO)(e.outputs.recommended_price_gbp_range),{x:50,y:m,size:20,font:d,color:p}),m-=25,l.drawText("LABOUR & MATERIALS",{x:50,y:m,size:12,font:d,color:u}),m-=18,["Labour: ".concat((0,r.yS)(e.outputs.labour_hours_range)),"Bricks: ".concat((0,r.nS)(e.outputs.brick_count_range)),"Sand: ".concat((0,r.nS)(e.outputs.materials.sand_kg_range)," kg"),"Cement: ".concat((0,r.nS)(e.outputs.materials.cement_bags_range)," bags")]))l.drawText(t,{x:50,y:m,size:10,font:o,color:u}),m-=18;if(m-=7,(null===(a=e.outputs.assumptions)||void 0===a?void 0:a.length)>0){for(let t of(l.drawText("ASSUMPTIONS",{x:50,y:m,size:12,font:d,color:u}),m-=18,e.outputs.assumptions)){let e="• ".concat(t).substring(0,80);l.drawText(e,{x:50,y:m,size:9,font:o,color:x}),m-=15}m-=7}if((null===(i=e.outputs.exclusions)||void 0===i?void 0:i.length)>0){for(let t of(l.drawText("EXCLUSIONS",{x:50,y:m,size:12,font:d,color:u}),m-=18,e.outputs.exclusions)){let e="• ".concat(t).substring(0,80);l.drawText(e,{x:50,y:m,size:9,font:o,color:x}),m-=15}m-=7}m=Math.max(m,130),l.drawLine({start:{x:50,y:m+10},end:{x:545,y:m+10},thickness:.5,color:(0,s.rgb)(.8,.8,.8)}),m-=10,l.drawText("DISCLAIMER",{x:50,y:m,size:10,font:d,color:x}),m-=15;let b=t.disclaimerText.split(" "),f="";for(let e of b){let t=f+(f?" ":"")+e;o.widthOfTextAtSize(t,8)>495?(l.drawText(f,{x:50,y:m,size:8,font:o,color:x}),m-=12,f=e):f=t}f&&l.drawText(f,{x:50,y:m,size:8,font:o,color:x}),l.drawText("Generated by Brickie App",{x:50,y:40,size:8,font:o,color:(0,s.rgb)(.6,.6,.6)});let j=new Blob([await n.save()],{type:"application/pdf"}),w=URL.createObjectURL(j),y=document.createElement("a");y.href=w,y.download="brickie-estimate-".concat(e.id,".pdf"),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(w)}},1184:function(e,t,a){"use strict";a.d(t,{o:function(){return s}});let s=(0,a(1447).U)((e,t)=>({user:null,profile:null,isLoading:!0,photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,isEstimating:!1,error:null,jobs:[],pricingMethod:"day_rate",dayRate:"220",ratePer1000:"500",ratePerM2:"65",materialMarkup:"10",includeVAT:!1,setUser:t=>e({user:t}),setProfile:t=>{if(t){var a,s;e({profile:t,dayRate:(null===(a=t.day_rate)||void 0===a?void 0:a.toString())||"220",pricingMethod:t.default_pricing_method||"day_rate",materialMarkup:(null===(s=t.material_markup)||void 0===s?void 0:s.toString())||"10",includeVAT:t.vat_registered||!1})}else e({profile:t})},setLoading:t=>e({isLoading:t}),setPhotoFile:t=>e({photoFile:t}),setPhotoPreview:t=>e({photoPreview:t}),setJobType:t=>e({jobType:t}),setAnchorType:t=>e({anchorType:t}),setAnchorValue:t=>e({anchorValue:t}),setDifficulty:t=>e({difficulty:t}),setHasOpenings:t=>e({hasOpenings:t}),setPricingMethod:t=>e({pricingMethod:t}),setDayRate:t=>e({dayRate:t}),setRatePer1000:t=>e({ratePer1000:t}),setRatePerM2:t=>e({ratePerM2:t}),setMaterialMarkup:t=>e({materialMarkup:t}),setIncludeVAT:t=>e({includeVAT:t}),setCurrentResult:t=>e({currentResult:t}),setEstimating:t=>e({isEstimating:t}),setError:t=>e({error:t}),resetEstimate:()=>e({photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,error:null}),setJobs:t=>e({jobs:t}),addJob:t=>e(e=>({jobs:[t,...e.jobs]})),removeJob:t=>e(e=>({jobs:e.jobs.filter(e=>e.id!==t)})),getInputs:()=>{let{jobType:e,anchorType:a,anchorValue:s,difficulty:r,hasOpenings:i}=t();if(!s)return null;let n=parseFloat(s);return isNaN(n)||n<=0?null:{jobType:e,anchorType:a,anchorValue:n,difficulty:r,hasOpenings:i,pricing:t().getPricingInputs()}},getPricingInputs:()=>{let{pricingMethod:e,dayRate:a,ratePer1000:s,ratePerM2:r,materialMarkup:i,includeVAT:n}=t();return{method:e,dayRate:parseFloat(a)||220,ratePer1000:parseFloat(s)||500,ratePerM2:parseFloat(r)||65,materialMarkup:parseFloat(i)||10,includeVAT:n,vatRate:20}}}))},9250:function(e,t,a){"use strict";a.d(t,{e:function(){return i}});var s=a(2059),r=a(8345);function i(){return(0,s.createBrowserClient)(r.env.NEXT_PUBLIC_SUPABASE_URL,r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},1117:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(5802).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}},function(e){e.O(0,[59,269,200,326,416,963,744],function(){return e(e.s=6125)}),_N_E=e.O()}]);