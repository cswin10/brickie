(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[450],{3966:function(e,t,a){Promise.resolve().then(a.bind(a,2188))},2188:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var s=a(6517),r=a(6557),n=a(6815);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a(5802).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var o=a(104),l=a(1052),c=a(9843),d=a(2338),u=a(9781),m=a(9115),x=a(9250),p=a(1184),h=a(9378),f=a(4988);function b(){var e,t;let a=(0,n.useParams)(),b=(0,n.useRouter)(),{user:g,profile:w,removeJob:y}=(0,p.o)(),[j,N]=(0,r.useState)(null),[v,_]=(0,r.useState)(!0),[T,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(!g||!a.id)return;let e=(0,x.e)();N(await (0,h.Zn)(e,a.id,g.id)),_(!1)})()},[g,a.id]);let S=async()=>{if(!g||!j||!confirm("Are you sure you want to delete this job?"))return;let e=(0,x.e)();await (0,h.CC)(e,j.id,g.id)&&(y(j.id),b.push("/dashboard/jobs"))},P=async()=>{if(j&&w){k(!0);try{await (0,f.b)({id:j.id,timestamp:new Date(j.created_at).getTime(),inputs:j.inputs,outputs:j.outputs,photoUri:j.photo_url||""},{companyName:w.company_name||"",defaultDayRate:w.day_rate||220,defaultPricingMethod:"day_rate",defaultRatePer1000:500,defaultRatePerM2:65,materialMarkup:10,vatRegistered:!1,vatRate:20,currency:"GBP",disclaimerText:w.disclaimer_text||""})}catch(e){console.error("Failed to generate PDF:",e)}finally{k(!1)}}};return v?(0,s.jsx)(m.wY,{}):j?(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsxs)("button",{onClick:()=>b.push("/dashboard/jobs"),className:"flex items-center text-warm-600 hover:text-warm-900 mb-6",children:[(0,s.jsx)(i,{className:"w-4 h-4 mr-2"}),"Back to Jobs"]}),(0,s.jsxs)("div",{className:"space-y-6",children:[j.photo_url&&(0,s.jsx)("img",{src:j.photo_url,alt:"Job photo",className:"w-full h-64 object-cover rounded-xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-warm-900",children:j.inputs.jobType}),(0,s.jsx)("p",{className:"text-sm text-warm-500",children:new Date(j.created_at).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,s.jsxs)("p",{className:"text-warm-600 mt-1",children:[j.inputs.anchorType,": ",j.inputs.anchorValue,"m •"," ",j.inputs.difficulty,j.inputs.hasOpenings?" • Has openings":""]})]}),(0,s.jsxs)("div",{className:"bg-brick-500 rounded-2xl p-6 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,s.jsx)(o.Z,{className:"w-5 h-5 opacity-80"}),(0,s.jsx)("span",{className:"text-sm font-medium opacity-80",children:"ESTIMATED PRICE"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:(0,h.NO)(j.outputs.recommended_price_gbp_range)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)(m.Zb,{className:"bg-warm-100",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)(l.Z,{className:"w-4 h-4 text-warm-600"}),(0,s.jsx)("span",{className:"text-xs font-medium text-warm-600 uppercase",children:"Labour"})]}),(0,s.jsx)("p",{className:"text-lg font-semibold text-warm-900",children:(0,h.yS)(j.outputs.labour_hours_range)})]}),(0,s.jsxs)(m.Zb,{className:"bg-warm-100",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-warm-600 uppercase",children:"Area"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-warm-900",children:[j.outputs.area_m2.toFixed(1)," m\xb2"]})]})]}),(0,s.jsx)(m.Zb,{title:"Materials",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-warm-200",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Z,{className:"w-4 h-4 text-brick-500"}),(0,s.jsx)("span",{className:"text-warm-700",children:"Bricks"})]}),(0,s.jsx)("span",{className:"font-semibold text-warm-900",children:(0,h.nS)(j.outputs.brick_count_range)})]}),(0,s.jsxs)("div",{className:"flex justify-between py-2 border-b border-warm-200",children:[(0,s.jsx)("span",{className:"text-warm-700",children:"Sand"}),(0,s.jsxs)("span",{className:"font-semibold text-warm-900",children:[(0,h.nS)(j.outputs.materials.sand_kg_range)," kg"]})]}),(0,s.jsxs)("div",{className:"flex justify-between py-2",children:[(0,s.jsx)("span",{className:"text-warm-700",children:"Cement"}),(0,s.jsxs)("span",{className:"font-semibold text-warm-900",children:[(0,h.nS)(j.outputs.materials.cement_bags_range)," bags"]})]})]})}),(null===(e=j.outputs.assumptions)||void 0===e?void 0:e.length)>0&&(0,s.jsx)(m.Zb,{title:"Assumptions",children:(0,s.jsx)("ul",{className:"space-y-2",children:j.outputs.assumptions.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-brick-500 rounded-full mt-2"}),(0,s.jsx)("span",{className:"text-warm-700",children:e})]},t))})}),(null===(t=j.outputs.exclusions)||void 0===t?void 0:t.length)>0&&(0,s.jsx)(m.Zb,{title:"Exclusions",children:(0,s.jsx)("ul",{className:"space-y-2",children:j.outputs.exclusions.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full mt-2"}),(0,s.jsx)("span",{className:"text-warm-700",children:e})]},t))})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)(m.zx,{variant:"outline",fullWidth:!0,onClick:P,loading:T,children:[(0,s.jsx)(d.Z,{className:"w-5 h-5 mr-2"}),"Generate PDF"]}),(0,s.jsxs)(m.zx,{variant:"ghost",fullWidth:!0,onClick:S,children:[(0,s.jsx)(u.Z,{className:"w-5 h-5 mr-2"}),"Delete Job"]})]})]})]}):(0,s.jsxs)("div",{className:"max-w-2xl mx-auto text-center py-12",children:[(0,s.jsx)("p",{className:"text-warm-600 mb-4",children:"Job not found"}),(0,s.jsx)(m.zx,{onClick:()=>b.push("/dashboard/jobs"),children:"Back to Jobs"})]})}},4988:function(e,t,a){"use strict";a.d(t,{b:function(){return n}});var s=a(2693),r=a(9378);async function n(e,t){var a,n;let i=await s.PDFDocument.create(),o=i.addPage([595,842]),{height:l}=o.getSize(),c=await i.embedFont(s.StandardFonts.Helvetica),d=await i.embedFont(s.StandardFonts.HelveticaBold),u=l-50,m=(0,s.rgb)(.2,.2,.2),x=(0,s.rgb)(.4,.4,.4),p=(0,s.rgb)(.73,.27,.17);o.drawText("BRICKIE ESTIMATE",{x:50,y:u,size:24,font:d,color:p}),u-=30,t.companyName&&(o.drawText(t.companyName,{x:50,y:u,size:14,font:d,color:m}),u-=18);let h=new Date(e.timestamp).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});for(let t of(o.drawText("Date: ".concat(h),{x:50,y:u,size:10,font:c,color:x}),u-=25,o.drawText("JOB DETAILS",{x:50,y:u,size:12,font:d,color:m}),u-=18,["Job Type: ".concat(e.inputs.jobType),"Anchor Dimension: ".concat(e.inputs.anchorType," = ").concat(e.inputs.anchorValue,"m"),"Difficulty: ".concat(e.inputs.difficulty),"Has Openings: ".concat(e.inputs.hasOpenings?"Yes":"No"),"Estimated Area: ".concat(e.outputs.area_m2.toFixed(1)," m\xb2")]))o.drawText(t,{x:50,y:u,size:10,font:c,color:m}),u-=18;for(let t of(u-=7,o.drawText("ESTIMATED PRICE",{x:50,y:u,size:12,font:d,color:m}),u-=23,o.drawText((0,r.NO)(e.outputs.recommended_price_gbp_range),{x:50,y:u,size:20,font:d,color:p}),u-=25,o.drawText("LABOUR & MATERIALS",{x:50,y:u,size:12,font:d,color:m}),u-=18,["Labour: ".concat((0,r.yS)(e.outputs.labour_hours_range)),"Bricks: ".concat((0,r.nS)(e.outputs.brick_count_range)),"Sand: ".concat((0,r.nS)(e.outputs.materials.sand_kg_range)," kg"),"Cement: ".concat((0,r.nS)(e.outputs.materials.cement_bags_range)," bags")]))o.drawText(t,{x:50,y:u,size:10,font:c,color:m}),u-=18;if(u-=7,(null===(a=e.outputs.assumptions)||void 0===a?void 0:a.length)>0){for(let t of(o.drawText("ASSUMPTIONS",{x:50,y:u,size:12,font:d,color:m}),u-=18,e.outputs.assumptions)){let e="• ".concat(t).substring(0,80);o.drawText(e,{x:50,y:u,size:9,font:c,color:x}),u-=15}u-=7}if((null===(n=e.outputs.exclusions)||void 0===n?void 0:n.length)>0){for(let t of(o.drawText("EXCLUSIONS",{x:50,y:u,size:12,font:d,color:m}),u-=18,e.outputs.exclusions)){let e="• ".concat(t).substring(0,80);o.drawText(e,{x:50,y:u,size:9,font:c,color:x}),u-=15}u-=7}u=Math.max(u,130),o.drawLine({start:{x:50,y:u+10},end:{x:545,y:u+10},thickness:.5,color:(0,s.rgb)(.8,.8,.8)}),u-=10,o.drawText("DISCLAIMER",{x:50,y:u,size:10,font:d,color:x}),u-=15;let f=t.disclaimerText.split(" "),b="";for(let e of f){let t=b+(b?" ":"")+e;c.widthOfTextAtSize(t,8)>495?(o.drawText(b,{x:50,y:u,size:8,font:c,color:x}),u-=12,b=e):b=t}b&&o.drawText(b,{x:50,y:u,size:8,font:c,color:x}),o.drawText("Generated by Brickie App",{x:50,y:40,size:8,font:c,color:(0,s.rgb)(.6,.6,.6)});let g=new Blob([await i.save()],{type:"application/pdf"}),w=URL.createObjectURL(g),y=document.createElement("a");y.href=w,y.download="brickie-estimate-".concat(e.id,".pdf"),document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(w)}},1184:function(e,t,a){"use strict";a.d(t,{o:function(){return s}});let s=(0,a(1447).U)((e,t)=>({user:null,profile:null,isLoading:!0,photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,isEstimating:!1,error:null,jobs:[],pricingMethod:"day_rate",dayRate:"220",ratePer1000:"500",ratePerM2:"65",materialMarkup:"10",includeVAT:!1,setUser:t=>e({user:t}),setProfile:t=>{if(t){var a,s;e({profile:t,dayRate:(null===(a=t.day_rate)||void 0===a?void 0:a.toString())||"220",pricingMethod:t.default_pricing_method||"day_rate",materialMarkup:(null===(s=t.material_markup)||void 0===s?void 0:s.toString())||"10",includeVAT:t.vat_registered||!1})}else e({profile:t})},setLoading:t=>e({isLoading:t}),setPhotoFile:t=>e({photoFile:t}),setPhotoPreview:t=>e({photoPreview:t}),setJobType:t=>e({jobType:t}),setAnchorType:t=>e({anchorType:t}),setAnchorValue:t=>e({anchorValue:t}),setDifficulty:t=>e({difficulty:t}),setHasOpenings:t=>e({hasOpenings:t}),setPricingMethod:t=>e({pricingMethod:t}),setDayRate:t=>e({dayRate:t}),setRatePer1000:t=>e({ratePer1000:t}),setRatePerM2:t=>e({ratePerM2:t}),setMaterialMarkup:t=>e({materialMarkup:t}),setIncludeVAT:t=>e({includeVAT:t}),setCurrentResult:t=>e({currentResult:t}),setEstimating:t=>e({isEstimating:t}),setError:t=>e({error:t}),resetEstimate:()=>e({photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,error:null}),setJobs:t=>e({jobs:t}),addJob:t=>e(e=>({jobs:[t,...e.jobs]})),removeJob:t=>e(e=>({jobs:e.jobs.filter(e=>e.id!==t)})),getInputs:()=>{let{jobType:e,anchorType:a,anchorValue:s,difficulty:r,hasOpenings:n}=t();if(!s)return null;let i=parseFloat(s);return isNaN(i)||i<=0?null:{jobType:e,anchorType:a,anchorValue:i,difficulty:r,hasOpenings:n,pricing:t().getPricingInputs()}},getPricingInputs:()=>{let{pricingMethod:e,dayRate:a,ratePer1000:s,ratePerM2:r,materialMarkup:n,includeVAT:i}=t();return{method:e,dayRate:parseFloat(a)||220,ratePer1000:parseFloat(s)||500,ratePerM2:parseFloat(r)||65,materialMarkup:parseFloat(n)||10,includeVAT:i,vatRate:20}}}))},9250:function(e,t,a){"use strict";a.d(t,{e:function(){return n}});var s=a(2059),r=a(8345);function n(){return(0,s.createBrowserClient)(r.env.NEXT_PUBLIC_SUPABASE_URL,r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},9781:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(5802).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[59,269,200,326,416,963,744],function(){return e(e.s=3966)}),_N_E=e.O()}]);