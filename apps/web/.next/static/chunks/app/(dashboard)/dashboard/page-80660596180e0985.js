(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{5164:function(e,t,a){Promise.resolve().then(a.bind(a,8068))},8068:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var r=a(6517),s=a(6557),l=a(6815),i=a(5559),n=a(508),o=a(6826),c=a(6882),d=a(599),u=a(4010),m=a(9115),h=a(1184),x=a(9378);let p=["Brickwork","Blockwork","Repointing","Demo+Rebuild"],b=["Easy","Standard","Tricky"],g=[{label:"Length",value:"length"},{label:"Height",value:"height"}],f=[{label:"Day Rate",value:"day_rate",description:"Charge per day worked"},{label:"Per 1000 Bricks",value:"per_1000_bricks",description:"Charge per 1000 bricks laid"},{label:"Per m\xb2",value:"per_m2",description:"Charge per square metre"}];function j(){let e=(0,l.useRouter)(),[t,a]=(0,s.useState)(null),[j,w]=(0,s.useState)(!1),{photoFile:v,photoPreview:k,jobType:y,anchorType:N,anchorValue:P,difficulty:_,hasOpenings:R,isEstimating:C,error:T,pricingMethod:I,dayRate:M,ratePer1000:E,ratePerM2:A,materialMarkup:V,includeVAT:F,setPhotoFile:Z,setPhotoPreview:D,setJobType:O,setAnchorType:J,setAnchorValue:L,setDifficulty:S,setHasOpenings:U,setCurrentResult:B,setEstimating:H,setError:q,getInputs:z,setPricingMethod:Y,setDayRate:G,setRatePer1000:W,setRatePerM2:K,setMaterialMarkup:Q,setIncludeVAT:X}=(0,h.o)(),$=(0,s.useCallback)(e=>{let t=e[0];t&&(Z(t),D(URL.createObjectURL(t)))},[Z,D]),{getRootProps:ee,getInputProps:et,isDragActive:ea}=(0,i.uI)({onDrop:$,accept:{"image/*":[".jpeg",".jpg",".png",".webp"]},maxFiles:1}),er=async()=>{if(a(null),q(null),!v){a("Please upload a photo of the job");return}let t=z();if(!t){a("Please enter a valid anchor dimension");return}H(!0);try{let a=await (0,x.sT)(v),r=await fetch("/api/estimate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:t,imageBase64:a})}),s=await r.json();if(!r.ok)throw Error(s.error||"Failed to get estimate");B(s.data),e.push("/dashboard/result")}catch(e){q(e instanceof Error?e.message:"An error occurred")}finally{H(!1)}};return(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-warm-900 mb-6",children:"New Estimate"}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(m.Zb,{title:"Job Photo",children:k?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:k,alt:"Job preview",className:"w-full h-64 object-cover rounded-xl"}),(0,r.jsx)("button",{onClick:()=>{Z(null),k&&URL.revokeObjectURL(k),D(null)},className:"absolute top-3 right-3 p-2 bg-black/50 rounded-full text-white hover:bg-black/70",children:(0,r.jsx)(n.Z,{className:"w-5 h-5"})})]}):(0,r.jsxs)("div",{...ee(),className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors ".concat(ea?"border-brick-500 bg-brick-50":"border-warm-300 hover:border-brick-400"),children:[(0,r.jsx)("input",{...et()}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-warm-100 rounded-full flex items-center justify-center mb-4",children:ea?(0,r.jsx)(o.Z,{className:"w-8 h-8 text-brick-500"}):(0,r.jsx)(c.Z,{className:"w-8 h-8 text-warm-500"})}),(0,r.jsx)("p",{className:"text-warm-700 font-medium mb-1",children:ea?"Drop the photo here":"Upload a photo"}),(0,r.jsx)("p",{className:"text-sm text-warm-500",children:"Drag & drop or click to select"})]})]})}),(0,r.jsx)(m.Zb,{title:"Job Type",children:(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:p.map(e=>(0,r.jsx)("button",{onClick:()=>O(e),className:"py-3 px-4 rounded-xl font-medium transition-colors ".concat(y===e?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:e},e))})}),(0,r.jsx)(m.Zb,{title:"Difficulty",children:(0,r.jsx)("div",{className:"flex gap-2",children:b.map(e=>(0,r.jsx)("button",{onClick:()=>S(e),className:"flex-1 py-3 px-4 rounded-xl font-medium transition-colors ".concat(_===e?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:e},e))})}),(0,r.jsxs)(m.Zb,{title:"Anchor Dimension",children:[(0,r.jsx)("p",{className:"text-sm text-warm-600 mb-4",children:"Enter one known dimension to help calibrate the estimate"}),(0,r.jsx)("div",{className:"flex gap-2 mb-4",children:g.map(e=>(0,r.jsx)("button",{onClick:()=>J(e.value),className:"flex-1 py-2 px-4 rounded-xl font-medium transition-colors ".concat(N===e.value?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:e.label},e.value))}),(0,r.jsx)(m.II,{label:"length"===N?"Length":"Height",type:"number",step:"0.1",placeholder:"e.g., 4.5",value:P,onChange:e=>L(e.target.value),suffix:"meters"})]}),(0,r.jsx)(m.Zb,{children:(0,r.jsxs)("label",{className:"flex items-center justify-between cursor-pointer",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-warm-900",children:"Has Openings"}),(0,r.jsx)("p",{className:"text-sm text-warm-600",children:"Doors, windows, or other openings"})]}),(0,r.jsx)("button",{onClick:()=>U(!R),className:"w-12 h-7 rounded-full transition-colors ".concat(R?"bg-brick-500":"bg-warm-300"),children:(0,r.jsx)("div",{className:"w-5 h-5 bg-white rounded-full shadow transform transition-transform mx-1 ".concat(R?"translate-x-5":"translate-x-0")})})]})}),(0,r.jsxs)(m.Zb,{children:[(0,r.jsxs)("button",{onClick:()=>w(!j),className:"w-full flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("p",{className:"font-medium text-warm-900",children:"Your Rates"}),(0,r.jsxs)("p",{className:"text-sm text-warm-600",children:["day_rate"===I&&"\xa3".concat(M,"/day"),"per_1000_bricks"===I&&"\xa3".concat(E,"/1000 bricks"),"per_m2"===I&&"\xa3".concat(A,"/m\xb2"),"0"!==V&&" • ".concat(V,"% markup"),F&&" • +VAT"]})]}),j?(0,r.jsx)(d.Z,{className:"w-5 h-5 text-warm-500"}):(0,r.jsx)(u.Z,{className:"w-5 h-5 text-warm-500"})]}),j&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-warm-200 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-warm-700 mb-2",children:"How do you charge?"}),(0,r.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,r.jsxs)("button",{onClick:()=>Y(e.value),className:"w-full text-left p-3 rounded-xl transition-colors ".concat(I===e.value?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:[(0,r.jsx)("p",{className:"font-medium",children:e.label}),(0,r.jsx)("p",{className:"text-sm ".concat(I===e.value?"text-brick-100":"text-warm-500"),children:e.description})]},e.value))})]}),"day_rate"===I&&(0,r.jsx)(m.II,{label:"Your Day Rate",type:"number",value:M,onChange:e=>G(e.target.value),prefix:"\xa3",suffix:"/day"}),"per_1000_bricks"===I&&(0,r.jsx)(m.II,{label:"Rate per 1000 Bricks",type:"number",value:E,onChange:e=>W(e.target.value),prefix:"\xa3",suffix:"/1000"}),"per_m2"===I&&(0,r.jsx)(m.II,{label:"Rate per m\xb2",type:"number",value:A,onChange:e=>K(e.target.value),prefix:"\xa3",suffix:"/m\xb2"}),(0,r.jsx)(m.II,{label:"Materials Markup",type:"number",value:V,onChange:e=>Q(e.target.value),suffix:"%"}),(0,r.jsxs)("label",{className:"flex items-center justify-between cursor-pointer",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-warm-900",children:"Add VAT"}),(0,r.jsx)("p",{className:"text-sm text-warm-600",children:"Include 20% VAT in quote"})]}),(0,r.jsx)("button",{onClick:()=>X(!F),className:"w-12 h-7 rounded-full transition-colors ".concat(F?"bg-brick-500":"bg-warm-300"),children:(0,r.jsx)("div",{className:"w-5 h-5 bg-white rounded-full shadow transform transition-transform mx-1 ".concat(F?"translate-x-5":"translate-x-0")})})]})]})]}),(t||T)&&(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:(0,r.jsx)("p",{className:"text-red-600",children:t||T})}),(0,r.jsx)(m.zx,{onClick:er,loading:C,fullWidth:!0,size:"lg",children:C?"Analysing Job...":"Get Estimate"})]})]})}},1184:function(e,t,a){"use strict";a.d(t,{o:function(){return r}});let r=(0,a(1447).U)((e,t)=>({user:null,profile:null,isLoading:!0,photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,isEstimating:!1,error:null,jobs:[],pricingMethod:"day_rate",dayRate:"220",ratePer1000:"500",ratePerM2:"65",materialMarkup:"10",includeVAT:!1,setUser:t=>e({user:t}),setProfile:t=>{if(t){var a,r;e({profile:t,dayRate:(null===(a=t.day_rate)||void 0===a?void 0:a.toString())||"220",pricingMethod:t.default_pricing_method||"day_rate",materialMarkup:(null===(r=t.material_markup)||void 0===r?void 0:r.toString())||"10",includeVAT:t.vat_registered||!1})}else e({profile:t})},setLoading:t=>e({isLoading:t}),setPhotoFile:t=>e({photoFile:t}),setPhotoPreview:t=>e({photoPreview:t}),setJobType:t=>e({jobType:t}),setAnchorType:t=>e({anchorType:t}),setAnchorValue:t=>e({anchorValue:t}),setDifficulty:t=>e({difficulty:t}),setHasOpenings:t=>e({hasOpenings:t}),setPricingMethod:t=>e({pricingMethod:t}),setDayRate:t=>e({dayRate:t}),setRatePer1000:t=>e({ratePer1000:t}),setRatePerM2:t=>e({ratePerM2:t}),setMaterialMarkup:t=>e({materialMarkup:t}),setIncludeVAT:t=>e({includeVAT:t}),setCurrentResult:t=>e({currentResult:t}),setEstimating:t=>e({isEstimating:t}),setError:t=>e({error:t}),resetEstimate:()=>e({photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,error:null}),setJobs:t=>e({jobs:t}),addJob:t=>e(e=>({jobs:[t,...e.jobs]})),removeJob:t=>e(e=>({jobs:e.jobs.filter(e=>e.id!==t)})),getInputs:()=>{let{jobType:e,anchorType:a,anchorValue:r,difficulty:s,hasOpenings:l}=t();if(!r)return null;let i=parseFloat(r);return isNaN(i)||i<=0?null:{jobType:e,anchorType:a,anchorValue:i,difficulty:s,hasOpenings:l,pricing:t().getPricingInputs()}},getPricingInputs:()=>{let{pricingMethod:e,dayRate:a,ratePer1000:r,ratePerM2:s,materialMarkup:l,includeVAT:i}=t();return{method:e,dayRate:parseFloat(a)||220,ratePer1000:parseFloat(r)||500,ratePerM2:parseFloat(s)||65,materialMarkup:parseFloat(l)||10,includeVAT:i,vatRate:20}}}))}},function(e){e.O(0,[269,370,326,416,963,744],function(){return e(e.s=5164)}),_N_E=e.O()}]);