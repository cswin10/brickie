(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{5164:function(e,t,r){Promise.resolve().then(r.bind(r,8068))},8068:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(6517),l=r(6557),a=r(6815),n=r(5559),o=r(508),i=r(6826),c=r(6882),d=r(9115),u=r(1184),h=r(9378);let m=["Brickwork","Blockwork","Repointing","Demo+Rebuild"],b=["Easy","Standard","Tricky"],x=[{label:"Length",value:"length"},{label:"Height",value:"height"}];function p(){let e=(0,a.useRouter)(),[t,r]=(0,l.useState)(null),{photoFile:p,photoPreview:g,jobType:f,anchorType:j,anchorValue:w,difficulty:v,hasOpenings:N,isEstimating:k,error:y,setPhotoFile:E,setPhotoPreview:T,setJobType:C,setAnchorType:P,setAnchorValue:R,setDifficulty:O,setHasOpenings:J,setCurrentResult:L,setEstimating:Z,setError:D,getInputs:F}=(0,u.o)(),U=(0,l.useCallback)(e=>{let t=e[0];t&&(E(t),T(URL.createObjectURL(t)))},[E,T]),{getRootProps:S,getInputProps:_,isDragActive:A}=(0,n.uI)({onDrop:U,accept:{"image/*":[".jpeg",".jpg",".png",".webp"]},maxFiles:1}),V=async()=>{if(r(null),D(null),!p){r("Please upload a photo of the job");return}let t=F();if(!t){r("Please enter a valid anchor dimension");return}Z(!0);try{let r=await (0,h.sT)(p),s=await fetch("/api/estimate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:t,imageBase64:r})}),l=await s.json();if(!s.ok)throw Error(l.error||"Failed to get estimate");L(l.data),e.push("/dashboard/result")}catch(e){D(e instanceof Error?e.message:"An error occurred")}finally{Z(!1)}};return(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-warm-900 mb-6",children:"New Estimate"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(d.Zb,{title:"Job Photo",children:g?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:g,alt:"Job preview",className:"w-full h-64 object-cover rounded-xl"}),(0,s.jsx)("button",{onClick:()=>{E(null),g&&URL.revokeObjectURL(g),T(null)},className:"absolute top-3 right-3 p-2 bg-black/50 rounded-full text-white hover:bg-black/70",children:(0,s.jsx)(o.Z,{className:"w-5 h-5"})})]}):(0,s.jsxs)("div",{...S(),className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors ".concat(A?"border-brick-500 bg-brick-50":"border-warm-300 hover:border-brick-400"),children:[(0,s.jsx)("input",{..._()}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-warm-100 rounded-full flex items-center justify-center mb-4",children:A?(0,s.jsx)(i.Z,{className:"w-8 h-8 text-brick-500"}):(0,s.jsx)(c.Z,{className:"w-8 h-8 text-warm-500"})}),(0,s.jsx)("p",{className:"text-warm-700 font-medium mb-1",children:A?"Drop the photo here":"Upload a photo"}),(0,s.jsx)("p",{className:"text-sm text-warm-500",children:"Drag & drop or click to select"})]})]})}),(0,s.jsx)(d.Zb,{title:"Job Type",children:(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:m.map(e=>(0,s.jsx)("button",{onClick:()=>C(e),className:"py-3 px-4 rounded-xl font-medium transition-colors ".concat(f===e?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:e},e))})}),(0,s.jsx)(d.Zb,{title:"Difficulty",children:(0,s.jsx)("div",{className:"flex gap-2",children:b.map(e=>(0,s.jsx)("button",{onClick:()=>O(e),className:"flex-1 py-3 px-4 rounded-xl font-medium transition-colors ".concat(v===e?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:e},e))})}),(0,s.jsxs)(d.Zb,{title:"Anchor Dimension",children:[(0,s.jsx)("p",{className:"text-sm text-warm-600 mb-4",children:"Enter one known dimension to help calibrate the estimate"}),(0,s.jsx)("div",{className:"flex gap-2 mb-4",children:x.map(e=>(0,s.jsx)("button",{onClick:()=>P(e.value),className:"flex-1 py-2 px-4 rounded-xl font-medium transition-colors ".concat(j===e.value?"bg-brick-500 text-white":"bg-warm-100 text-warm-700 hover:bg-warm-200"),children:e.label},e.value))}),(0,s.jsx)(d.II,{label:"length"===j?"Length":"Height",type:"number",step:"0.1",placeholder:"e.g., 4.5",value:w,onChange:e=>R(e.target.value),suffix:"meters"})]}),(0,s.jsx)(d.Zb,{children:(0,s.jsxs)("label",{className:"flex items-center justify-between cursor-pointer",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-warm-900",children:"Has Openings"}),(0,s.jsx)("p",{className:"text-sm text-warm-600",children:"Doors, windows, or other openings"})]}),(0,s.jsx)("button",{onClick:()=>J(!N),className:"w-12 h-7 rounded-full transition-colors ".concat(N?"bg-brick-500":"bg-warm-300"),children:(0,s.jsx)("div",{className:"w-5 h-5 bg-white rounded-full shadow transform transition-transform mx-1 ".concat(N?"translate-x-5":"translate-x-0")})})]})}),(t||y)&&(0,s.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:(0,s.jsx)("p",{className:"text-red-600",children:t||y})}),(0,s.jsx)(d.zx,{onClick:V,loading:k,fullWidth:!0,size:"lg",children:k?"Analysing Job...":"Get Estimate"})]})]})}},1184:function(e,t,r){"use strict";r.d(t,{o:function(){return s}});let s=(0,r(1447).U)((e,t)=>({user:null,profile:null,isLoading:!0,photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,isEstimating:!1,error:null,jobs:[],setUser:t=>e({user:t}),setProfile:t=>e({profile:t}),setLoading:t=>e({isLoading:t}),setPhotoFile:t=>e({photoFile:t}),setPhotoPreview:t=>e({photoPreview:t}),setJobType:t=>e({jobType:t}),setAnchorType:t=>e({anchorType:t}),setAnchorValue:t=>e({anchorValue:t}),setDifficulty:t=>e({difficulty:t}),setHasOpenings:t=>e({hasOpenings:t}),setCurrentResult:t=>e({currentResult:t}),setEstimating:t=>e({isEstimating:t}),setError:t=>e({error:t}),resetEstimate:()=>e({photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,error:null}),setJobs:t=>e({jobs:t}),addJob:t=>e(e=>({jobs:[t,...e.jobs]})),removeJob:t=>e(e=>({jobs:e.jobs.filter(e=>e.id!==t)})),getInputs:()=>{let{jobType:e,anchorType:r,anchorValue:s,difficulty:l,hasOpenings:a}=t();if(!s)return null;let n=parseFloat(s);return isNaN(n)||n<=0?null:{jobType:e,anchorType:r,anchorValue:n,difficulty:l,hasOpenings:a}}}))}},function(e){e.O(0,[269,461,326,416,963,744],function(){return e(e.s=5164)}),_N_E=e.O()}]);