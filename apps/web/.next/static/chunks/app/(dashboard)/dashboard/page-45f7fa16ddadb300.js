(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{5164:function(e,t,a){Promise.resolve().then(a.bind(a,8068))},8068:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var s=a(6517),l=a(6557),r=a(6815),i=a(5559),n=a(508),c=a(6882),o=a(9936),d=a(3488),m=a(1203),h=a(4010),u=a(7014),x=a(1184),p=a(9378);let b=[{label:"Brickwork",value:"Brickwork",icon:"\uD83E\uDDF1"},{label:"Blockwork",value:"Blockwork",icon:"â¬œ"},{label:"Repointing",value:"Repointing",icon:"\uD83D\uDD27"},{label:"Demo+Rebuild",value:"Demo+Rebuild",icon:"\uD83D\uDD28"}],g=[{label:"Easy",value:"Easy",color:"bg-emerald-500"},{label:"Standard",value:"Standard",color:"bg-amber-500"},{label:"Tricky",value:"Tricky",color:"bg-red-500"}],f=[{label:"Day Rate",value:"day_rate",description:"Charge per day worked"},{label:"Per 1000 Bricks",value:"per_1000_bricks",description:"Charge per 1000 bricks laid"},{label:"Per m\xb2",value:"per_m2",description:"Charge per square metre"}];function j(){let e=(0,r.useRouter)(),[t,a]=(0,l.useState)(null),[j,v]=(0,l.useState)(!1),N=(0,l.useRef)(null),k=(0,l.useRef)(null),{photoFile:w,photoPreview:y,jobType:P,anchorType:_,anchorValue:C,difficulty:R,hasOpenings:T,isEstimating:D,error:E,pricingMethod:M,dayRate:F,ratePer1000:A,ratePerM2:S,materialMarkup:V,includeVAT:O,setPhotoFile:J,setPhotoPreview:L,setJobType:Z,setAnchorType:B,setAnchorValue:U,setDifficulty:I,setHasOpenings:H,setCurrentResult:q,setEstimating:G,setError:W,getInputs:Y,setPricingMethod:z,setDayRate:K,setRatePer1000:Q,setRatePerM2:X,setMaterialMarkup:$,setIncludeVAT:ee}=(0,x.o)(),et=e=>{J(e),L(URL.createObjectURL(e))},ea=(0,l.useCallback)(e=>{let t=e[0];t&&et(t)},[J,L]),{getRootProps:es,getInputProps:el,isDragActive:er}=(0,i.uI)({onDrop:ea,accept:{"image/*":[".jpeg",".jpg",".png",".webp",".heic"]},maxFiles:1,noClick:!0}),ei=e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&et(a)},en=async()=>{if(a(null),W(null),!w){a("Please take or upload a photo of the job");return}let t=Y();if(!t){a("Please enter a valid dimension");return}G(!0);try{let a=await (0,p.sT)(w),s=await fetch("/api/estimate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:t,imageBase64:a})}),l=await s.json();if(!s.ok)throw Error(l.error||"Failed to get estimate");q(l.data),e.push("/dashboard/result")}catch(e){W(e instanceof Error?e.message:"An error occurred")}finally{G(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 pb-8",children:[(0,s.jsx)("input",{ref:N,type:"file",accept:"image/*",capture:"environment",onChange:ei,className:"hidden"}),(0,s.jsx)("input",{ref:k,type:"file",accept:"image/*",onChange:ei,className:"hidden"}),(0,s.jsx)("div",{className:"bg-gradient-to-r from-brick-600 to-brick-700 text-white px-4 pt-6 pb-12 -mx-4 sm:mx-0 sm:rounded-b-3xl mb-[-2rem]",children:(0,s.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"New Estimate"}),(0,s.jsx)("p",{className:"text-brick-100 mt-1 text-sm sm:text-base",children:"Snap a photo and get an instant quote"})]})}),(0,s.jsxs)("div",{className:"max-w-lg mx-auto px-4 space-y-4",children:[(0,s.jsx)("div",{...es(),className:"card-modern overflow-hidden ".concat(er?"ring-2 ring-brick-500 ring-offset-2":""),children:y?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:y,alt:"Job preview",className:"w-full h-56 sm:h-64 object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"}),(0,s.jsx)("button",{onClick:()=>{J(null),y&&URL.revokeObjectURL(y),L(null)},className:"absolute top-3 right-3 p-2 bg-black/40 backdrop-blur-sm rounded-full text-white hover:bg-black/60 transition-all tap-highlight",children:(0,s.jsx)(n.Z,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"absolute bottom-3 left-3 text-white",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Photo ready"}),(0,s.jsx)("p",{className:"text-xs text-white/70",children:"Tap \xd7 to retake"})]})]}):(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("input",{...el()}),(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 mx-auto bg-gradient-to-br from-brick-100 to-brick-200 rounded-2xl flex items-center justify-center mb-4",children:(0,s.jsx)(c.Z,{className:"w-8 h-8 text-brick-600"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"Add Job Photo"}),(0,s.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Take a photo of the space or existing wall"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("button",{onClick:()=>{var e;null===(e=N.current)||void 0===e||e.click()},className:"flex items-center justify-center gap-2 py-4 px-4 bg-gradient-to-br from-brick-500 to-brick-600 text-white rounded-2xl font-semibold shadow-lg shadow-brick-500/25 hover:shadow-brick-500/40 transition-all tap-highlight",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Take Photo"})]}),(0,s.jsxs)("button",{onClick:()=>{var e;null===(e=k.current)||void 0===e||e.click()},className:"flex items-center justify-center gap-2 py-4 px-4 bg-slate-100 text-slate-700 rounded-2xl font-semibold hover:bg-slate-200 transition-all tap-highlight",children:[(0,s.jsx)(o.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Gallery"})]})]})]})}),(0,s.jsxs)("div",{className:"card-modern p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-3",children:"Job Type"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:b.map(e=>(0,s.jsxs)("button",{onClick:()=>Z(e.value),className:"relative py-3.5 px-4 rounded-xl font-medium transition-all tap-highlight ".concat(P===e.value?"bg-gradient-to-br from-brick-500 to-brick-600 text-white shadow-lg shadow-brick-500/25":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[(0,s.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.value))})]}),(0,s.jsxs)("div",{className:"card-modern p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-3",children:"Difficulty"}),(0,s.jsx)("div",{className:"flex gap-2",children:g.map(e=>(0,s.jsx)("button",{onClick:()=>I(e.value),className:"flex-1 py-3.5 px-4 rounded-xl font-medium transition-all tap-highlight ".concat(R===e.value?"".concat(e.color," text-white shadow-lg"):"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:e.label},e.value))})]}),(0,s.jsxs)("div",{className:"card-modern p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4 text-brick-500"}),(0,s.jsx)("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide",children:"Reference Dimension"})]}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mb-3",children:"Enter one known measurement to calibrate the estimate"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,s.jsx)("button",{onClick:()=>B("length"),className:"flex-1 py-2.5 px-4 rounded-xl font-medium text-sm transition-all tap-highlight ".concat("length"===_?"bg-slate-800 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Width/Length"}),(0,s.jsx)("button",{onClick:()=>B("height"),className:"flex-1 py-2.5 px-4 rounded-xl font-medium text-sm transition-all tap-highlight ".concat("height"===_?"bg-slate-800 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Height"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"number",step:"0.1",placeholder:"e.g. 4.5",value:C,onChange:e=>U(e.target.value),className:"w-full input-modern py-3.5 px-4 text-lg font-medium"}),(0,s.jsx)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:"metres"})]})]}),(0,s.jsx)("div",{className:"card-modern p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-slate-800",children:"Has Openings?"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"Doors, windows, or gaps"})]}),(0,s.jsx)("button",{onClick:()=>H(!T),className:"relative w-14 h-8 rounded-full transition-all ".concat(T?"bg-gradient-to-r from-brick-500 to-brick-600":"bg-slate-200"),children:(0,s.jsx)("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ".concat(T?"left-7":"left-1")})})]})}),(0,s.jsxs)("div",{className:"card-modern overflow-hidden",children:[(0,s.jsxs)("button",{onClick:()=>v(!j),className:"w-full p-4 flex items-center justify-between tap-highlight",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center",children:(0,s.jsx)(m.Z,{className:"w-5 h-5 text-slate-600"})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"font-semibold text-slate-800",children:"Your Rates"}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:["day_rate"===M&&"\xa3".concat(F,"/day"),"per_1000_bricks"===M&&"\xa3".concat(A,"/1000"),"per_m2"===M&&"\xa3".concat(S,"/m\xb2"),O&&" +VAT"]})]})]}),(0,s.jsx)(h.Z,{className:"w-5 h-5 text-slate-400 transition-transform ".concat(j?"rotate-180":"")})]}),j&&(0,s.jsxs)("div",{className:"px-4 pb-4 space-y-4 border-t border-slate-100 pt-4",children:[(0,s.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,s.jsxs)("button",{onClick:()=>z(e.value),className:"w-full text-left p-3 rounded-xl transition-all tap-highlight ".concat(M===e.value?"bg-slate-800 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[(0,s.jsx)("p",{className:"font-medium",children:e.label}),(0,s.jsx)("p",{className:"text-sm ".concat(M===e.value?"text-slate-300":"text-slate-500"),children:e.description})]},e.value))}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium",children:"\xa3"}),(0,s.jsx)("input",{type:"number",value:"day_rate"===M?F:"per_1000_bricks"===M?A:S,onChange:e=>{"day_rate"===M?K(e.target.value):"per_1000_bricks"===M?Q(e.target.value):X(e.target.value)},className:"w-full input-modern py-3.5 pl-8 pr-4 text-lg font-medium"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-600 mb-1 block",children:"Materials Markup"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"number",value:V,onChange:e=>$(e.target.value),className:"w-full input-modern py-3 px-4 font-medium"}),(0,s.jsx)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400",children:"%"})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"font-medium text-slate-700",children:"Add VAT (20%)"})}),(0,s.jsx)("button",{onClick:()=>ee(!O),className:"relative w-14 h-8 rounded-full transition-all ".concat(O?"bg-gradient-to-r from-brick-500 to-brick-600":"bg-slate-200"),children:(0,s.jsx)("div",{className:"absolute top-1 w-6 h-6 bg-white rounded-full shadow-md transition-all ".concat(O?"left-7":"left-1")})})]})]})]}),(t||E)&&(0,s.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-2xl",children:(0,s.jsx)("p",{className:"text-red-600 text-sm font-medium",children:t||E})}),(0,s.jsx)("button",{onClick:en,disabled:D,className:"w-full py-4 px-6 rounded-2xl font-bold text-lg flex items-center justify-center gap-2 transition-all ".concat(D?"bg-slate-200 text-slate-400":"btn-gradient text-white"),children:D?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-slate-400 border-t-transparent rounded-full animate-spin"}),"Analysing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,{className:"w-5 h-5"}),"Get Estimate"]})}),(0,s.jsx)("div",{className:"h-4"})]})]})}},1184:function(e,t,a){"use strict";a.d(t,{o:function(){return s}});let s=(0,a(1447).U)((e,t)=>({user:null,profile:null,isLoading:!0,photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,isEstimating:!1,error:null,jobs:[],pricingMethod:"day_rate",dayRate:"220",ratePer1000:"500",ratePerM2:"65",materialMarkup:"10",includeVAT:!1,setUser:t=>e({user:t}),setProfile:t=>{if(t){var a,s;e({profile:t,dayRate:(null===(a=t.day_rate)||void 0===a?void 0:a.toString())||"220",pricingMethod:t.default_pricing_method||"day_rate",materialMarkup:(null===(s=t.material_markup)||void 0===s?void 0:s.toString())||"10",includeVAT:t.vat_registered||!1})}else e({profile:t})},setLoading:t=>e({isLoading:t}),setPhotoFile:t=>e({photoFile:t}),setPhotoPreview:t=>e({photoPreview:t}),setJobType:t=>e({jobType:t}),setAnchorType:t=>e({anchorType:t}),setAnchorValue:t=>e({anchorValue:t}),setDifficulty:t=>e({difficulty:t}),setHasOpenings:t=>e({hasOpenings:t}),setPricingMethod:t=>e({pricingMethod:t}),setDayRate:t=>e({dayRate:t}),setRatePer1000:t=>e({ratePer1000:t}),setRatePerM2:t=>e({ratePerM2:t}),setMaterialMarkup:t=>e({materialMarkup:t}),setIncludeVAT:t=>e({includeVAT:t}),setCurrentResult:t=>e({currentResult:t}),setEstimating:t=>e({isEstimating:t}),setError:t=>e({error:t}),resetEstimate:()=>e({photoFile:null,photoPreview:null,jobType:"Brickwork",anchorType:"length",anchorValue:"",difficulty:"Standard",hasOpenings:!1,currentResult:null,error:null}),setJobs:t=>e({jobs:t}),addJob:t=>e(e=>({jobs:[t,...e.jobs]})),removeJob:t=>e(e=>({jobs:e.jobs.filter(e=>e.id!==t)})),getInputs:()=>{let{jobType:e,anchorType:a,anchorValue:s,difficulty:l,hasOpenings:r}=t();if(!s)return null;let i=parseFloat(s);return isNaN(i)||i<=0?null:{jobType:e,anchorType:a,anchorValue:i,difficulty:l,hasOpenings:r,pricing:t().getPricingInputs()}},getPricingInputs:()=>{let{pricingMethod:e,dayRate:a,ratePer1000:s,ratePerM2:l,materialMarkup:r,includeVAT:i}=t();return{method:e,dayRate:parseFloat(a)||220,ratePer1000:parseFloat(s)||500,ratePerM2:parseFloat(l)||65,materialMarkup:parseFloat(r)||10,includeVAT:i,vatRate:20}}}))}},function(e){e.O(0,[247,693,378,416,963,744],function(){return e(e.s=5164)}),_N_E=e.O()}]);